{% sw_extends '@Storefront/storefront/layout/navigation/categories.html.twig' %}
{% block layout_navigation_categories %}
    {% set navigationMaxDepth = 3 %}

    {% if not level %}
        {% set level = 0 %}
        {% set display = 0 %}
    {% endif %}
    {% set bcLimit =  context.context.extensions['bcMenuConfig'].get('bcLimit')['bcLimit'] %}
    {% if bcLimit is empty %}
        {% set bcLimit = 10 %}
    {% endif %}


    <div class="{% if level == 0 %}row {% endif %}navigation-flyout-categories is-level-{{ level }}">
    
        {% for treeItem in navigationTree %}
            {% set id = treeItem.category.id %}
            {% set name = treeItem.category.translated.name %}
            {% set link = category_url(treeItem.category) %}

            {% block layout_navigation_categories_item %}
                <div class="{% if level == 0 %}{% if navigationMedia %}col-4 {% else %}col-3 {% endif %}{% endif %}navigation-flyout-col">
                    {% block layout_navigation_categories_item_link %}
                        {% if treeItem.category.type == 'folder' %}
                            <div class="nav-item nav-link navigation-flyout-link is-level-{{ level }}"
                                 title="{{ name }}">
                                <span itemprop="name" data-image="">{{ treeItem.category.translated.name }}</span>
                            </div>
                        {% else %}

							{% if display < bcLimit  %}

                                <a class="nav-item nav-link navigation-flyout-link is-level-{{ level }}{% if treeItem.category.id is same as(page.header.navigation.active.id) %} active{% endif %}"
                                    href="{{ link }}"
                                    itemprop="url"
                                    {% if category_linknewtab(treeItem.category) %}target="_blank"
                                        {% if treeItem.category.linkType == "external" %}rel="noopener noreferrer"{% endif %}
                                    {% endif %}
                                    title="{{ name }}"
                                    data-image="{% if treeItem.category.extensions.bccategoryimage %}{{ treeItem.category.extensions.bccategoryimage }}{% endif %}">
                                    <span itemprop="name" class="{% if treeItem.category.extensions.bchovereffect!=''%}{{treeItem.category.extensions.bchovereffect}}{%endif%}">{{ treeItem.category.translated.name }}</span>
                                </a>

                            {% elseif (display == bcLimit and level >= 1) %}

                                <a class="nav-link"
                                    href="{{ link }}"
                                    itemprop="url"
                                    {% if category_linknewtab(treeItem.category) %}target="_blank"
                                        {% if treeItem.category.linkType == "external" %}rel="noopener noreferrer"{% endif %}
                                    {% endif %}
                                    title="{{ name }}">
                                    {% block layout_navigation_flyout_bar_category_link_text1 %}
                                        {{ "general.toCategory"|trans }} 
                                            {% sw_icon 'arrow-right' style {
                                                'color': 'primary',
                                                'pack':'solid'
                                            } %}
                                    {% endblock %}
                                </a>

                            {% endif %}
                        {% endif %}
                    {% endblock %}

                    {% block layout_navigation_categories_recoursion %}
                        {% if level < navigationMaxDepth %}
                            {% sw_include '@Storefront/storefront/layout/navigation/categories.html.twig' with {
                                navigationTree: treeItem.children,
                                level: level + 1
                            } only %}
                        {% endif %}
                    {% endblock %}
                </div>
            {% endblock %}
            {% set display=display+1 %}
        {% endfor %}
    </div>
{% endblock %}
