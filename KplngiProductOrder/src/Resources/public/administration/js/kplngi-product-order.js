!function(t){var e={};function r(o){if(e[o])return e[o].exports;var i=e[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=t,r.c=e,r.d=function(t,e,o){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(o,i,function(e){return t[e]}.bind(null,i));return o},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/bundles/kplngiproductorder/",r(r.s="G06t")}({G06t:function(t,e,r){"use strict";r.r(e);Shopware.Component.override("sw-category-view",{template:"{% block sw_category_view_tabs_cms %}\n    {% parent %}\n    <sw-tabs-item\n        :route=\"{name: 'kplngi.product.order', params: { id: $route.params.id } }\"\n        :title=\"$tc('kplngi-product-order.extension.tabHeadline')\">\n        {{ $tc('kplngi-product-order.extension.tabHeadline') }}\n    </sw-tabs-item>\n{% endblock %}\n"});r("y9Lr");var o=Shopware.Data.Criteria;Shopware.Component.register("kplngi-product-order",{template:'{% block kplngi_product_order %}\n    <div class="kplngi-product-order">\n        <sw-card :title="$tc(\'kplngi-product-order.title\')">\n            <div class="kplngi-product-order-configuration">\n                <sw-field type="switch"\n                          v-model="orderSwitch"\n                          @change="onSwitch(orderSwitch)"\n                          :disabled="switchDisabled"\n                          :label="$tc(\'kplngi-product-order.switch\')">\n                </sw-field>\n                <div class="kplngi-product-order-table-filter">\n                    <sw-simple-search-field\n                        :disabled="!productCategoryPositions"\n                        :searchTerm="searchTerm"\n                        @search-term-change="filterProducts"\n                    ></sw-simple-search-field>\n                </div>\n                <div class="kplngi-product-order-table-assist">\n                    <kplngi-product-order-refresh-button\n                        :isLoading="isLoading"\n                        :orderActive="orderSwitch"\n                        @button-click="refreshProducts"\n                    ></kplngi-product-order-refresh-button>\n\n                    <sw-help-text\n                        :text="$tc(\'kplngi-product-order.helpText\')">\n                    </sw-help-text>\n                </div>\n            </div>\n\n            <kplngi-product-order-entity-listing\n                v-if="productCategoryPositions"\n                :items="productCategoryPositions"\n                :repository="productCategoryPositionRepository"\n                :columns="columns"\n                :showSelection="false"\n                :fullPage="false"\n                :isLoading="isLoading"\n            >\n            </kplngi-product-order-entity-listing>\n        </sw-card>\n    </div>\n{% endblock %}\n',metaInfo:function(){return{title:this.$tc("kplngi-product-order.title")}},inject:["repositoryFactory"],mixins:[Shopware.Mixin.getByName("notification")],data:function(){return{orderSwitch:!1,products:null,isLoading:!1,processSuccess:!1,switchDisabled:!0,productCategoryPositions:null,syncService:null,httpClient:null,searchTerm:null}},computed:{category:function(){return Shopware.State.get("swCategoryDetail").category},productCategoryPositionRepository:function(){return this.repositoryFactory.create("kplngi_productcategoryposition")},productRepository:function(){return this.repositoryFactory.create("product",this.category.products.source)},categoryRepository:function(){return this.repositoryFactory.create("category")},orderActiveRepository:function(){return this.repositoryFactory.create("kplngi_orderactive")},columns:function(){return[{property:"position",dataIndex:"position",label:this.$tc("kplngi-product-order.table.priority"),inlineEdit:"number",primary:!0},{property:"product.name",dataIndex:"product.name",label:this.$tc("kplngi-product-order.table.product")},{property:"product.productNumber",dataIndex:"product.productNumber",label:this.$tc("kplngi-product-order.table.productNumber")}]}},created:function(){var t=this;this.syncService=Shopware.Service("syncService"),this.httpClient=this.syncService.httpClient,this.isCustomOrderEnabled().then((function(e){e.total>0?(t.orderSwitch=!0,t.loadCategoryProductPositions()):t.orderSwitch=!1,t.switchDisabled=!1}))},methods:{onSwitch:function(t){t?(this.switchDisabled=!0,this.saveCategoryProductsOrder()):(this.switchDisabled=!0,this.deleteCategoryProductsPositions())},saveCategoryProductsOrder:function(){this.isLoading=!0,this.httpClient.get("/kplngi/productorder/init/".concat(this.category.id),{headers:this.syncService.getBasicHeaders()}).then(this.loadCategoryProductPositions)},isCustomOrderEnabled:function(){var t=new o;return t.addFilter(o.equals("categoryId",this.category.id)),this.orderActiveRepository.searchIds(t,Shopware.Context.api)},deleteCategoryProductsPositions:function(){var t=this;this.isLoading=!0,this.httpClient.get("/kplngi/productorder/delete/".concat(this.category.id),{headers:this.syncService.getBasicHeaders()}).then((function(){t.productCategoryPositions=null,t.isLoading=!1,t.switchDisabled=!1,t.searchTerm=null}))},loadCategoryProductPositions:function(){var t=this;this.isLoading=!0;var e=new o;e.addFilter(o.equals("categoryId",this.category.id)),e.addAssociation("product"),this.productCategoryPositionRepository.search(e,Shopware.Context.api).then((function(e){t.productCategoryPositions=e,t.isLoading=!1,t.switchDisabled=!1}))},setCustomSortedCategory:function(){var t=this.orderActiveRepository.create(Shopware.Context.api);t.categoryId=this.category.id,this.orderActiveRepository.save(t,Shopware.Context.api)},removeCustomSortedCategory:function(){var t=this,e=new o;e.addFilter(o.equals("categoryId",this.category.id)),this.searchTerm=null,this.orderActiveRepository.searchIds(e,Shopware.Context.api).then((function(e){t.orderActiveRepository.delete(e.data[0],Shopware.Context.api)}))},noProductsInCategory:function(){this.createNotificationInfo({title:this.$tc("kplngi-product-order.notification"),message:" "})},refreshProducts:function(){this.isLoading=!0,this.searchTerm=null,this.httpClient.get("/kplngi/productorder/refresh/".concat(this.category.id),{headers:this.syncService.getBasicHeaders()}).then(this.loadCategoryProductPositions)},filterProducts:function(t){var e=this;if(this.searchTerm=t,""!==t){this.isLoading=!0;var r=new o;r.addAssociation("product"),r.addFilter(o.multi("OR",[o.contains("product.name",t),o.contains("product.productNumber",t),o.contains("position",t)])),r.setTerm(t),r.addFilter(o.equals("categoryId",this.category.id)),this.productCategoryPositionRepository.search(r,Shopware.Context.api).then((function(t){e.searchTerm===t.criteria.term&&(e.productCategoryPositions=t,e.isLoading=!1)}))}else this.loadCategoryProductPositions()}}});r("ltYC");Shopware.Component.register("kplngi-product-order-refresh-button",{template:'{% block sw_sidebar_navisadfgation_item %}\n    <button\n        @click="emitButtonClicked"\n        class="kplngi-product-order-refresh-button"\n        :class="{ \'is--disabled\': isLoading || !orderActive }"\n        :disabled="isLoading || !orderActive"\n        >\n\n        <sw-icon name="default-arrow-360-left" size="20px"></sw-icon>\n    </button>\n\n{% endblock %}\n',props:{isLoading:{type:Boolean,default:!1},orderActive:{type:Boolean,default:!1}},methods:{emitButtonClicked:function(){this.$emit("button-click")}}});r("nZKT");Shopware.Module.register("kplngi-product-order",{routeMiddleware:function(t,e){"sw.category.detail"===e.name&&e.children.push({name:"kplngi.product.order",path:"/sw/category/index/:id/order",component:"kplngi-product-order",meta:{parentPath:"sw.category.index"}}),t(e)}})},HGL9:function(t,e,r){},HcdO:function(t,e,r){},SZ7m:function(t,e,r){"use strict";function o(t,e){for(var r=[],o={},i=0;i<e.length;i++){var n=e[i],s=n[0],a={id:t+":"+i,css:n[1],media:n[2],sourceMap:n[3]};o[s]?o[s].parts.push(a):r.push(o[s]={id:s,parts:[a]})}return r}r.r(e),r.d(e,"default",(function(){return g}));var i="undefined"!=typeof document;if("undefined"!=typeof DEBUG&&DEBUG&&!i)throw new Error("vue-style-loader cannot be used in a non-browser environment. Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.");var n={},s=i&&(document.head||document.getElementsByTagName("head")[0]),a=null,c=0,d=!1,u=function(){},l=null,p="data-vue-ssr-id",h="undefined"!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function g(t,e,r,i){d=r,l=i||{};var s=o(t,e);return f(s),function(e){for(var r=[],i=0;i<s.length;i++){var a=s[i];(c=n[a.id]).refs--,r.push(c)}e?f(s=o(t,e)):s=[];for(i=0;i<r.length;i++){var c;if(0===(c=r[i]).refs){for(var d=0;d<c.parts.length;d++)c.parts[d]();delete n[c.id]}}}}function f(t){for(var e=0;e<t.length;e++){var r=t[e],o=n[r.id];if(o){o.refs++;for(var i=0;i<o.parts.length;i++)o.parts[i](r.parts[i]);for(;i<r.parts.length;i++)o.parts.push(m(r.parts[i]));o.parts.length>r.parts.length&&(o.parts.length=r.parts.length)}else{var s=[];for(i=0;i<r.parts.length;i++)s.push(m(r.parts[i]));n[r.id]={id:r.id,refs:1,parts:s}}}}function y(){var t=document.createElement("style");return t.type="text/css",s.appendChild(t),t}function m(t){var e,r,o=document.querySelector("style["+p+'~="'+t.id+'"]');if(o){if(d)return u;o.parentNode.removeChild(o)}if(h){var i=c++;o=a||(a=y()),e=w.bind(null,o,i,!1),r=w.bind(null,o,i,!0)}else o=y(),e=C.bind(null,o),r=function(){o.parentNode.removeChild(o)};return e(t),function(o){if(o){if(o.css===t.css&&o.media===t.media&&o.sourceMap===t.sourceMap)return;e(t=o)}else r()}}var v,b=(v=[],function(t,e){return v[t]=e,v.filter(Boolean).join("\n")});function w(t,e,r,o){var i=r?"":o.css;if(t.styleSheet)t.styleSheet.cssText=b(e,i);else{var n=document.createTextNode(i),s=t.childNodes;s[e]&&t.removeChild(s[e]),s.length?t.insertBefore(n,s[e]):t.appendChild(n)}}function C(t,e){var r=e.css,o=e.media,i=e.sourceMap;if(o&&t.setAttribute("media",o),l.ssrId&&t.setAttribute(p,e.id),i&&(r+="\n/*# sourceURL="+i.sources[0]+" */",r+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(i))))+" */"),t.styleSheet)t.styleSheet.cssText=r;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(r))}}},ltYC:function(t,e,r){var o=r("HGL9");o.__esModule&&(o=o.default),"string"==typeof o&&(o=[[t.i,o,""]]),o.locals&&(t.exports=o.locals);(0,r("SZ7m").default)("357920fe",o,!0,{})},nZKT:function(t,e){var r=Shopware.Data.Criteria;Shopware.Component.extend("kplngi-product-order-entity-listing","sw-entity-listing",{methods:{doSearch:function(){return this.loading=!0,this.items.criteria.addSorting(r.sort("product.name")),this.repository.search(this.items.criteria,this.items.context).then(this.applyResult)}}})},y9Lr:function(t,e,r){var o=r("HcdO");o.__esModule&&(o=o.default),"string"==typeof o&&(o=[[t.i,o,""]]),o.locals&&(t.exports=o.locals);(0,r("SZ7m").default)("4b40fc6b",o,!0,{})}});