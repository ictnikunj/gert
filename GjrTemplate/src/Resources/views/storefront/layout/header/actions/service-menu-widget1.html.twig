{% sw_extends '@UltraStoreSwitcher/storefront/layout/header/actions/service-menu-widget.html.twig' %}

{% block layout_header_actions_service_menu_widget %}

{% set UltraStoreSwitcher = shopware.config.UltraStoreSwitcher.config %}


{% set number = UltraStoreSwitcher|length -1 %}

{% set myarrayhead = [] %}
{% set myarray = [] %}

{% set counting=0 %}
{% set counting1=0 %}

{% for i in 1..number %}

{% set counting1=0 %}
{% for key,value in UltraStoreSwitcher %}

	{% if "Kanal" ~ i in key %}
		{% set counting1=counting1 +1 %}
	{% endif %}
{% endfor %}

{% for key,value in UltraStoreSwitcher %}


    {% if "Kanal" ~ i in key %}
	{% set counting=counting +1 %}

		{% if "langonoff" in key  %}
			{% set valuelon = "" %}
			{% if value !="" %}
				{% set valuelon = value %}
			{% endif %}
		{% endif %}

		{% if ";;" in value %}
			{% set switching = "" %}
			{% set switching0 = "" %}
			{% set switching1 = "" %}
			{% set switching2 = "" %}
			{% set switching = value|split(";;") %} 
			{% if switching[0] !="" %}
			{% set switching0 = switching[0] %}
			{% set switching1 = switching[1] %}
			{% set switching2 = switching[2] %}

			{% if switching[2] == context.salesChannel.accessKey %}
				{% set value0 = true %}
			{% endif %}
			
			{% if switching[2] != context.salesChannel.accessKey %}
				{% set value0 = false %}
			{% endif %}

		
			{% endif %}
		{% endif %}
		
		{% if "url" in key  %}
			{% set valueurl = "" %}
			{% if value !="" %}
				{% set valueurl = value %}
			{% endif %}
		{% endif %}
		
		{% if "title" in key  %}
			{% set valuetitle = "" %}
			{% if value !="" %}
				{% set valuetitle = value %}
			{% endif %}
		{% endif %}

		{% if "name" in key  %}
			{% set valuenome = "" %}
			{% if value !="" %}
				{% set valuenome = value %}
			{% endif %}
		{% endif %}
		
		{% if "ownflagonoff" in key %}
			{% set valueflagownon = "" %}
			{% if value !="" %}
				{% set valueflagownon = value %}
			{% endif %}
		{% endif %}
		
		{% if "flagger" in key %}
			{% set valuef = "" %}
			{% if value !="" %}
				{% set valuef = value %}
			{% endif %}
		{% endif %}

		{% if value0 and counting==counting1 %}
			{% set myarrayhead = myarrayhead|merge([{ 'langonoff': valuelon, 'kuerzel': switching[1], 'namen': switching[0], 'ownflagonoff': valueflagownon, 'flagger': valuef, 'ownname': valuenome, 'link':valueurl, 'title':valuetitle }]) %}
			{% set counting=0 %}
		{% endif %}
		
		{% if not value0 and counting==counting1 %}
			{% set myarray = myarray|merge([{ 'langonoff': valuelon, 'kuerzel': switching[1], 'namen': switching[0], 'ownflagonoff': valueflagownon, 'flagger': valuef, 'ownname': valuenome, 'link':valueurl, 'title':valuetitle }]) %}
			{% set counting=0 %}
		{% endif %}
		

		
	{% endif %}
	
	
{% endfor %}

{% endfor %}



{% if UltraStoreSwitcher.activeKanal and number > 0 %}

        <div class="top-bar-nav-item top-bar-menu">
            {% block layout_header_actions_store_menu_list %}
                <div class="gjrte1 service-menu dropdown">
                    <button class="btn dropdown-toggle top-bar-nav-btn"
                            type="button"
                            id="serviceMenuDropdown-{{ position }}"
                            data-toggle="dropdown"
                            aria-haspopup="true"
                            aria-expanded="false">

							{% for item in myarrayhead %}
							
							{% set isoCode = item.kuerzel|lower|split('-') %}
							 {% set country = isoCode[0] %}
							 {% set language = isoCode[1] %}
							
							{% if item.ownflagonoff and UltraStoreSwitcher.flagonoff and item.flagger !="" %}
								   
											{% set mediaid=item.flagger %}
											{% set media = searchMedia([mediaid], context.context).get(mediaid) %}
												{%if mediaid != ""%}
													<span class="top-bar-list-icon ultra-topbar-own-icon">
														<img src="{{media.url}}">
													</span>{% if item.ownname !="" %}{{ item.ownname }}{% else %}{{ item.namen }}{% endif %}
												{%endif%}
								   {% endif %}
							
							{% if not item.ownflagonoff and UltraStoreSwitcher.flagonoff %}
							<div class="top-bar-list-icon language-flag country-{{ country }} language-{{ language }}"></div>
							<span class="top-bar-nav-text-own">{% if item.ownname !="" %}{{ item.ownname }}{% else %}{{ item.namen }}{% endif %}</span>
							{% endif %}
							
							{% if not UltraStoreSwitcher.flagonoff %}
							<span class="top-bar-nav-text-own">{% if item.ownname !="" %}{{ item.ownname }}{% else %}{{ item.namen }}{% endif %}</span>
							{% endif %}
							
							                                
							{% endfor %}
                        
                    </button>
                    {% block layout_header_actions_store_menu_items %}
					<div class="dropdown-menu dropdown-menu-right"
                             aria-labelledby="serviceMenuDropdown-{{ position }}">
							
					{% for item in myarray %}
					
					{% set isoCode = item.kuerzel|lower|split('-') %}
							 {% set country = isoCode[0] %}
							 {% set language = isoCode[1] %}
					
								{% if item.namen !="" and item.langonoff %}
                                 <a class="top-bar-list-item dropdown-item"
                                   href="{{ item.link }}"
                                   title="{% if item.title !='' %}{{ item.title }}{% else %}{% if item.ownname !="" %}{{ item.ownname }}{% else %}{{ item.namen }}{% endif %}{% endif %}">

								   {% if item.ownflagonoff and UltraStoreSwitcher.flagonoff and item.flagger !="" %}
								   
											{% set mediaid=item.flagger %}
											{% set media = searchMedia([mediaid], context.context).get(mediaid) %}
												{%if mediaid != ""%}
													<span class="top-bar-list-icon ultra-topbar-own-icon">
														<img src="{{media.url}}">
													</span>{% if item.ownname !="" %}{{ item.ownname }}{% else %}{{ item.namen }}{% endif %}
												{%endif%}
								   {% endif %}
								   	
									{% if item.ownflagonoff and UltraStoreSwitcher.flagonoff and item.flagger =="" %}
								   <span class="top-bar-list-icon language-flag country-{{ country }} language-{{ language }}"></span>
								   {% if item.ownname !="" %}{{ item.ownname }}{% else %}{{ item.namen }}{% endif %}
								   {% endif %}
									
								   {% if not item.ownflagonoff and UltraStoreSwitcher.flagonoff %}
								   <span class="top-bar-list-icon language-flag country-{{ country }} language-{{ language }}"></span>
								   {% if item.ownname !="" %}{{ item.ownname }}{% else %}{{ item.namen }}{% endif %}
								   {% endif %}
								   
								   {% if not UltraStoreSwitcher.flagonoff %}
								   {% if item.ownname !="" %}{{ item.ownname }}{% else %}{{ item.namen }}{% endif %}
								   {% endif %}
								   
								   </a>
{% endif %}
					{% endfor %}
					 </div>
                        
						
					
                    {% endblock %}
                </div>
            {% endblock %}
        </div>

{% endif %}
{% endblock %}